<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="createScav.css">
  </head>
  <body>
	  <div class="screen">
	  <div id="myDIV" class="header">
		  <h2>Create Scavenger Hunt</h2>
		  <input type="text" class="title" id="titleInput" placeholder="Title">
		  <input type="text" class="desc" id="descInput" placeholder="Description">
		  <input type="text" class="task" id="myInput" placeholder="Tasks...">
		  <span class="addBtn" id="addBtn">Add</span>
		</div>
		
		<ul id="myUL">
		</ul>

		<button type="button" class="create" id="createButton" disabled="True">Create</button>
		</div>
	</body>
    <script type="module">
		import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
		  
		const firebaseConfig = {
		  apiKey: "AIzaSyAN5-vaIFOwaz2ar8mFqfDeEGawJU_5OEo",
		  authDomain: "team-17-scavenger-hunt-hub.firebaseapp.com",
		  databaseURL: "https://team-17-scavenger-hunt-hub-default-rtdb.firebaseio.com",
		  projectId: "team-17-scavenger-hunt-hub",
		  storageBucket: "team-17-scavenger-hunt-hub.appspot.com",
		  messagingSenderId: "313893582260",
		  appId: "1:313893582260:web:141161df49a4b48e06aee1",
		  measurementId: "G-7FMS2C0D22"
		};
	  
		const app = initializeApp(firebaseConfig);

		import {getDatabase, ref, child, get, set, update, remove, onValue} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

		const db = getDatabase();
		
		var createButton = document.getElementById('createButton');
		var addButton = document.getElementById('addBtn');
		var titleInput = document.getElementById('titleInput');
		var descInput = document.getElementById('descInput');
		var tasks = document.getElementById("myUL");
		var taskList = [];
		
		var title = "";
		var desc = "";
		var idNum = 100001;
		var date = "";
		var rating = 0;
		var filter = "kid-friendly";
		
		titleInput.oninput = checkTitle;
		function checkTitle() {
			createButton.disabled = !titleInput.value.trim();
		}

		createButton.addEventListener('click', function() {
			title = titleInput.value;
			desc = descInput.value;
			
			var currentDate = new Date();
			var month = currentDate.getMonth() + 1;
			var day = currentDate.getDate();
			var year = currentDate.getFullYear();
			date = month + '/' + day + '/' + year;
			
			tasks.querySelectorAll("li").forEach(function(li) {
				taskList.push(li.textContent);
			});
			
			for (let i = 0; i < taskList.length; i++) {
				taskList[i] = taskList[i].slice(0, -1);
			}
			
			GetData();
		});
		
		addButton.addEventListener('click', function() {
			newElement();
		});
		
		async function GetData(){
			const dbRef = ref(db, 'hunts/');
			const snapshot = await get(dbRef);

			snapshot.forEach((childSnapshot) => {
				if (childSnapshot.val().id == idNum)
					idNum++;
			});		
			save();
		}
		
		function save() {
			set(ref(db, 'hunts/' + title), {
				title : title,
				desc : desc,
				id : idNum,
				rating : rating,
				date : date,
				filter : filter,
				tasks : taskList
			})
			.then(() => {
				window.location.href = "index.html";
			})
		}
		
		// Create a "close" button and append it to each list item
		var myNodelist = document.getElementsByTagName("LI");
		var i;
		for (i = 0; i < myNodelist.length; i++) {
		  var span = document.createElement("SPAN");
		  var txt = document.createTextNode("\u00D7");
		  span.className = "close";
		  span.appendChild(txt);
		  myNodelist[i].appendChild(span);
		}

		// Click on a close button to hide the current list item
		var close = document.getElementsByClassName("close");
		var i;
		for (i = 0; i < close.length; i++) {
		  close[i].onclick = function() {
			var div = this.parentElement;
			div.style.display = "none";
		  }
		}

		// Create a new list item when clicking on the "Add" button
		function newElement() {
		  var li = document.createElement("li");
		  var inputValue = document.getElementById("myInput").value;
		  var t = document.createTextNode(inputValue);
		  li.appendChild(t);
		  if (inputValue === '') {
			alert("You must write something!");
		  } else {
			document.getElementById("myUL").appendChild(li);
		  }
		  document.getElementById("myInput").value = "";

		  var span = document.createElement("SPAN");
		  var txt = document.createTextNode("\u00D7");
		  span.className = "close";
		  span.appendChild(txt);
		  li.appendChild(span);

		  for (i = 0; i < close.length; i++) {
			close[i].onclick = function() {
			  var div = this.parentElement;
			  div.style.display = "none";
			}
		  }
		}
	</script>
</html>